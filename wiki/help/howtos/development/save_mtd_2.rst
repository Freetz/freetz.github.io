help/howtos/development/save_mtd_2
==================================
Howtos: Entwicklung
^^^^^^^^^^^^^^^^^^^

#. `Entpacken und Packen von
   Firmware-Images <repack_fw.html#EntpackenundPackenvonFirmware-Images>`__

   #. `Tools und Syntax <repack_fw.html#ToolsundSyntax>`__
   #. `Vorgehensweise <repack_fw.html#Vorgehensweise>`__
   #. `Verwendung von fwmod im "no
      freetz"-Modus <repack_fw.html#Verwendungvonfwmodimnofreetz-Modus>`__

#. `Patches in Freetz
   einspielen <integrate_patches.html#PatchesinFreetzeinspielen>`__
#. `Example 3:
   NZBGet <developer_information/package_development_start/example_3.html#Example3:NZBGet>`__

   #. `Build
      manually <developer_information/package_development_start/example_3.html#Buildmanually>`__
   #. `Add package to
      Freetz <developer_information/package_development_start/example_3.html#AddpackagetoFreetz>`__
   #. `Create new image with added
      package <developer_information/package_development_start/example_3.html#Createnewimagewithaddedpackage>`__
   #. `Testing <developer_information/package_development_start/example_3.html#Testing>`__
   #. `Preparing New Package for Public Integration to Freetz
      Trunk <developer_information/package_development_start/example_3.html#PreparingNewPackageforPublicIntegrationtoFreetzTrunk>`__

#. `Example 2:
   par2cmdline <developer_information/package_development_start/example_2.html#Example2:par2cmdline>`__

   #. `Build
      manually <developer_information/package_development_start/example_2.html#Buildmanually>`__
   #. `Add package to
      Freetz <developer_information/package_development_start/example_2.html#AddpackagetoFreetz>`__
   #. `Create new image with added
      package <developer_information/package_development_start/example_2.html#Createnewimagewithaddedpackage>`__
   #. `Testing <developer_information/package_development_start/example_2.html#Testing>`__
   #. `Preparing New Package for Public Integration to Freetz
      Trunk <developer_information/package_development_start/example_2.html#PreparingNewPackageforPublicIntegrationtoFreetzTrunk>`__

#. `Example 1:
   Httptunnel <developer_information/package_development_start/example_1.html#Example1:Httptunnel>`__

   #. `Build
      manually <developer_information/package_development_start/example_1.html#Buildmanually>`__
   #. `Add package to
      Freetz <developer_information/package_development_start/example_1.html#AddpackagetoFreetz>`__
   #. `Call Procedures "make menuconfig" and
      "make" <developer_information/package_development_start/example_1.html#CallProceduresmakemenuconfigandmake>`__
   #. `Testing <developer_information/package_development_start/example_1.html#Testing>`__
   #. `Preparing New Package for Public Integration to Freetz
      Trunk <developer_information/package_development_start/example_1.html#PreparingNewPackageforPublicIntegrationtoFreetzTrunk>`__

#. 

   #. `Signieren von Firmware <sign_image.html#SignierenvonFirmware>`__
   #. `Konkrete Anwendung in
      Freetz <sign_image.html#KonkreteAnwendunginFreetz>`__

#. `Ablauf eines
   Firmware-Updates <firmware_update_details.html#AblaufeinesFirmware-Updates>`__
#. `Eigene Programme
   kompilieren <compile_own_progs.html#EigeneProgrammekompilieren>`__
#. `Dynamische Bandbreitenanzeige per
   SVG <bandwidth_svg.html#DynamischeBandbreitenanzeigeperSVG>`__

   #. `Anleitung zur
      Test-Installation <bandwidth_svg.html#AnleitungzurTest-Installation>`__

#. `Platz sparen im Dateisystem der
   FritzBox <make_room.html#PlatzsparenimDateisystemderFritzBox>`__

   #. `Vorwort und Motivation <make_room.html#VorwortundMotivation>`__
   #. `Bestandsaufnahme: Wo stecken die
      Platzfresser? <make_room.html#Bestandsaufnahme:WosteckendiePlatzfresser>`__
   #. `Weitere Spartricks <make_room.html#WeitereSpartricks>`__
   #. `Schlußwort <make_room.html#Schlußwort>`__

#. `Flash-Partitionen im laufenden Betrieb
   sichern <save_mtd_1.html#Flash-PartitionenimlaufendenBetriebsichern>`__

   #. `Motivation <save_mtd_1.html#Motivation>`__
   #. `Voraussetzungen <save_mtd_1.html#Voraussetzungen>`__
   #. `Lösungsweg <save_mtd_1.html#Lösungsweg>`__
   #. `Wege, sich schnell einen Überblick zu
      verschaffen <save_mtd_1.html#WegesichschnelleinenÜberblickzuverschaffen>`__
   #. `Zusammenfassung <save_mtd_1.html#Zusammenfassung>`__

#. `Release Management <release_management.html#ReleaseManagement>`__

   #. `Subversion
      Repository <release_management.html#SubversionRepository>`__
   #. `Checklists <release_management.html#Checklists>`__
   #. `GIT <release_management.html#GIT>`__
   #. `Downloads <release_management.html#Downloads>`__
   #. `References <release_management.html#References>`__

#. `First steps - How to start your first freetz
   package <developer_information/package_development_start.html#Firststeps-Howtostartyourfirstfreetzpackage>`__

   #. `Info <developer_information/package_development_start.html#Info>`__
   #. `Build
      Environment <developer_information/package_development_start.html#BuildEnvironment>`__
   #. `File
      Structure <developer_information/package_development_start.html#FileStructure>`__
   #. `Examples Binary
      Package <developer_information/package_development_start.html#ExamplesBinaryPackage>`__
   #. `Configuration
      Handling <developer_information/package_development_start.html#ConfigurationHandling>`__
   #. `Examples
      Web-Interface <developer_information/package_development_start.html#ExamplesWeb-Interface>`__
   #. `Trouble
      shooting <developer_information/package_development_start.html#Troubleshooting>`__

#. `Kernel konfigurieren und
   kompilieren <make_kernel.html#Kernelkonfigurierenundkompilieren>`__
#. `Menükonfiguration
   pflegen <menuconfig.html#Menükonfigurationpflegen>`__

   #. `Einstieg <menuconfig.html#Einstieg>`__
   #. `Beispiel-Konfiguration für ein neues
      Paket <menuconfig.html#Beispiel-KonfigurationfüreinneuesPaket>`__
   #. `Menuconfig-Warnungen
      beheben <menuconfig.html#Menuconfig-Warnungenbeheben>`__
   #. `Erklärung und Anwendung der erweiterten
      MK-Targets <menuconfig.html#ErklärungundAnwendungdererweitertenMK-Targets>`__
   #. `Syntax-Fehler in MK-Dateien
      finden <menuconfig.html#Syntax-FehlerinMK-Dateienfinden>`__
   #. `Syntax-Hervorhebung für
      MK-Dateien <menuconfig.html#Syntax-HervorhebungfürMK-Dateien>`__

#. `ADAM2-Bootloader <adam2.html#ADAM2-Bootloader>`__

   #. `Bootloader-Backup
      anlegen <adam2.html#Bootloader-Backupanlegen>`__
   #. `Bootloader überschreiben <adam2.html#Bootloaderüberschreiben>`__
   #. `Bootloader-Befehle <adam2.html#Bootloader-Befehle>`__
   #. `Bootloader-Quelltext <adam2.html#Bootloader-Quelltext>`__
   #. `Aufbau des Bootloaders <adam2.html#AufbaudesBootloaders>`__
   #. `Bootloader und Freetz <adam2.html#BootloaderundFreetz>`__

#. `Einstellungen speichern im
   Urlader-Environment <urlader_flags.html#EinstellungenspeichernimUrlader-Environment>`__

   #. `Vorwort und
      Motivation <urlader_flags.html#VorwortundMotivation>`__
   #. `Lösungsmöglichkeiten <urlader_flags.html#Lösungsmöglichkeiten>`__
   #. `Bootloader
      Environment <urlader_flags.html#BootloaderEnvironment>`__
   #. `Variable
      "kernel_args" <urlader_flags.html#Variablekernel_args>`__
   #. `Kernel_Args-API <urlader_flags.html#Kernel_Args-API>`__
   #. `Mögliche
      Anwendungsfälle <urlader_flags.html#MöglicheAnwendungsfälle>`__

#. `Busybox konfigurieren und
   kompilieren <make_busybox.html#Busyboxkonfigurierenundkompilieren>`__
#. `Wie baue ich ein eigenes Paket für
   Freetz? <package_creation.html#WiebaueicheineigenesPaketfürFreetz>`__
#. `Firmware-Image-Namen analysieren und
   interpretieren <analyse_image_names.html#Firmware-Image-Namenanalysierenundinterpretieren>`__

   #. `Einleitung <analyse_image_names.html#Einleitung>`__
   #. `Skript-Code <analyse_image_names.html#Skript-Code>`__
   #. `Daten im Rohformat <analyse_image_names.html#DatenimRohformat>`__
   #. `Ausgabe grundlegender
      Informationen <analyse_image_names.html#AusgabegrundlegenderInformationen>`__
   #. `Ausgabe erweiterter
      Informationen <analyse_image_names.html#AusgabeerweiterterInformationen>`__

#. 

   #. `Web-interface
      HTTPTunnel <developer_information/package_development_start/webinterface_example_1.html#Web-interfaceHTTPTunnel>`__

#. `Developer
   Information <developer_information.html#DeveloperInformation>`__
#. `Addon Paket
   installieren <install_addon.html#AddonPaketinstallieren>`__
#. `Paketverwaltung für
   Freetz <developer_information/package_development_dynamic.html#PaketverwaltungfürFreetz>`__

   #. `Erweiterung des
      Dateisystems <developer_information/package_development_dynamic.html#ErweiterungdesDateisystems>`__
   #. `Paketverwaltung <developer_information/package_development_dynamic.html#Paketverwaltung>`__
   #. `Links <developer_information/package_development_dynamic.html#Links>`__
   #. `Kommentare <developer_information/package_development_dynamic.html#Kommentare>`__

#. `Wie die FritzBox Manipulationen
   erkennt <manipulation_detection.html#WiedieFritzBoxManipulationenerkennt>`__

   #. `Ursachen <manipulation_detection.html#Ursachen>`__
   #. `Diagnose <manipulation_detection.html#Diagnose>`__
   #. `Lösungen <manipulation_detection.html#Lösungen>`__
   #. `Schlußwort und
      Ausblick <manipulation_detection.html#SchlußwortundAusblick>`__

#. `Shell Coding
   Conventions <developer_information/shell_coding_conventions.html#ShellCodingConventions>`__

   #. `Shell
      Language <developer_information/shell_coding_conventions.html#ShellLanguage>`__
   #. `Basic
      Format <developer_information/shell_coding_conventions.html#BasicFormat>`__
   #. `If, For, and
      While <developer_information/shell_coding_conventions.html#IfForandWhile>`__
   #. `Test
      Built-in <developer_information/shell_coding_conventions.html#TestBuilt-in>`__
   #. `Single-line conditional
      statements <developer_information/shell_coding_conventions.html#Single-lineconditionalstatements>`__
   #. `Infinite
      Loops <developer_information/shell_coding_conventions.html#InfiniteLoops>`__
   #. `Exit Status and If/While
      Statements <developer_information/shell_coding_conventions.html#ExitStatusandIfWhileStatements>`__
   #. `Variable
      References <developer_information/shell_coding_conventions.html#VariableReferences>`__
   #. `Variable
      Naming <developer_information/shell_coding_conventions.html#VariableNaming>`__
   #. `Quoting <developer_information/shell_coding_conventions.html#Quoting>`__
   #. `Variable
      Assignments <developer_information/shell_coding_conventions.html#VariableAssignments>`__
   #. `Testing for (Non-)Empty
      Strings <developer_information/shell_coding_conventions.html#TestingforNon-EmptyStrings>`__
   #. `Commenting <developer_information/shell_coding_conventions.html#Commenting>`__
   #. `Pathnames <developer_information/shell_coding_conventions.html#Pathnames>`__
   #. `Interpreter
      Magic <developer_information/shell_coding_conventions.html#InterpreterMagic>`__

#. `Package
   Development <developer_information/package_development.html#PackageDevelopment>`__

   #. `Persistent Package
      Settings <developer_information/package_development.html#PersistentPackageSettings>`__

#. `Erstellen einer GUI für Pakete in
   Freetz <create_gui.html#ErstelleneinerGUIfürPaketeinFreetz>`__

   #. `Motivation <create_gui.html#Motivation>`__
   #. `Grundlagen <create_gui.html#Grundlagen>`__
   #. `Wie funktioniert das mit der
      GUI? <create_gui.html#WiefunktioniertdasmitderGUI>`__

#. `Flash Partitionierung <flash.html#FlashPartitionierung>`__

   #. `Hidden SquashFS <flash.html#HiddenSquashFS>`__
   #. `Contiguous SquashFS <flash.html#ContiguousSquashFS>`__
   #. `Hidden Root <flash.html#HiddenRoot>`__
   #. `NAND Root <flash.html#NANDRoot>`__
   #. `Dateisystem <flash.html#Dateisystem>`__
   #. `Kernel <flash.html#Kernel>`__
   #. `Weblinks <flash.html#Weblinks>`__

#. `Trac
   Hooks <developer_information/post_commit_hook.html#TracHooks>`__

   #. `trac-post-commit-hook <developer_information/post_commit_hook.html#trac-post-commit-hook>`__
   #. `trac-post-revprop-change-hook <developer_information/post_commit_hook.html#trac-post-revprop-change-hook>`__

#. `Package Developing - Advanced
   Topics <developer_information/package_development_advanced.html#PackageDeveloping-AdvancedTopics>`__

   #. `Adding conditional
      patches <developer_information/package_development_advanced.html#Addingconditionalpatches>`__
   #. `Adding multi-binary
      packages <developer_information/package_development_advanced.html#Addingmulti-binarypackages>`__

#. `Eigene Dateien in die Firmware
   integrieren <integrate_own_files.html#EigeneDateienindieFirmwareintegrieren>`__

   #. `Feste Integration über das Freetz
      Image <integrate_own_files.html#FesteIntegrationüberdasFreetzImage>`__
   #. `Erzeugen der Dateien aus der
      debug.cfg <integrate_own_files.html#ErzeugenderDateienausderdebug.cfg>`__
   #. `Nachladen vom
      Webserver <integrate_own_files.html#NachladenvomWebserver>`__
   #. `Nachladen vom
      USB-Stick <integrate_own_files.html#NachladenvomUSB-Stick>`__
   #. `WebDAV Share
      mounten <integrate_own_files.html#WebDAVSharemounten>`__
   #. `NFS-Share mounten <integrate_own_files.html#NFS-Sharemounten>`__

#. `Freetz Build-Prozeß <freetz_make.html#FreetzBuild-Prozeß>`__

   #. `Vorwort und Motivation <freetz_make.html#VorwortundMotivation>`__
   #. `Grundsätzliches <freetz_make.html#Grundsätzliches>`__

#. `Flash-Partitionen von außen mit FTP
   sichern <save_mtd_2.html#Flash-PartitionenvonaußenmitFTPsichern>`__

   #. `Motivation <save_mtd_2.html#Motivation>`__
   #. `Voraussetzungen <save_mtd_2.html#Voraussetzungen>`__
   #. `Allgemeine Informationen zur
      Datensicherung <save_mtd_2.html#AllgemeineInformationenzurDatensicherung>`__
   #. `Sicherung mit Linux-Standard-FTP
      (ftp) <save_mtd_2.html#SicherungmitLinux-Standard-FTPftp>`__
   #. `Sicherung mit Linux-NcFTP
      (ncftpget) <save_mtd_2.html#SicherungmitLinux-NcFTPncftpget>`__
   #. `Sicherung mit Cygwin-NcFTP
      (ncftpget) <save_mtd_2.html#SicherungmitCygwin-NcFTPncftpget>`__
   #. `Uploads via FTP <save_mtd_2.html#UploadsviaFTP>`__

#. `libmodcgi.sh <developer_information/webif/libmodcgi.html#libmodcgi.sh>`__

   #. `cgi <developer_information/webif/libmodcgi.html#cgi>`__
   #. `cgi_begin <developer_information/webif/libmodcgi.html#cgi_begin>`__
   #. `cgi_end <developer_information/webif/libmodcgi.html#cgi_end>`__
   #. `sec_begin <developer_information/webif/libmodcgi.html#sec_begin>`__
   #. `sec_end <developer_information/webif/libmodcgi.html#sec_end>`__
   #. `html <developer_information/webif/libmodcgi.html#html>`__
   #. `check,
      select <developer_information/webif/libmodcgi.html#checkselect>`__
   #. `href <developer_information/webif/libmodcgi.html#href>`__
   #. `back_button <developer_information/webif/libmodcgi.html#back_button>`__
   #. `sec_level <developer_information/webif/libmodcgi.html#sec_level>`__
   #. `stat_bar <developer_information/webif/libmodcgi.html#stat_bar>`__
   #. `cgi_param <developer_information/webif/libmodcgi.html#cgi_param>`__
   #. `cgi_error,
      print_error <developer_information/webif/libmodcgi.html#cgi_errorprint_error>`__
   #. `path_info <developer_information/webif/libmodcgi.html#path_info>`__
   #. `valid <developer_information/webif/libmodcgi.html#valid>`__

#. `Cross-Compiler / Toolchain
   erstellen <create_cross-compiler_toolchain.html#Cross-CompilerToolchainerstellen>`__
#. `Eigene Download-Toolchain
   erstellen <create_cross-compiler_toolchain.html#EigeneDownload-Toolchainerstellen>`__
#. `Target/Native-Compiler-Toolchain
   erstellen <create_cross-compiler_toolchain.html#TargetNative-Compiler-Toolchainerstellen>`__

   #. `Using the dev-tools package to install compiler and
      tools <create_cross-compiler_toolchain.html#Usingthedev-toolspackagetoinstallcompilerandtools>`__

.. _Flash-PartitionenvonaußenmitFTPsichern:

Flash-Partitionen von außen mit FTP sichern
===========================================

Dieser Artikel baut auf dem Artikel
`Flash-Partitionierung <flash.html>`__ auf. Ihn vorher zu lesen, schadet
also nicht. Mein herzlicher Dank für einige der Informationen zu diesem
Artikel gebührt Enrik Berkhan, der sich hier immer vornehm zurückhält,
aber sooo viel weiß. |:-)|

.. _Motivation:

Motivation
----------

Im verwandten Artikel `Flash-Partitionen im laufenden Betrieb
sichern <save_mtd_1.html>`__ habe ich erklärt, wie man direkt von der
Konsole (SSH, Telnet, Rudi-Shell) auf der FritzBox aus über
entsprechende Linux-Block- bzw. -Character-Devices Datensicherungen
vornehmen kann. Das gleiche geht auch "von außen", also ohne
Shell-Zugriff von der Box, indem man per FTP den Urlader - neudeutsch
Bootloader - kontaktiert. Früher hieß der Urlader
`ADAM2 <adam2.html>`__, heute EVA bei den aktuellen Kernel-2.6-Firmwares
(obwohl die Login-Daten immer noch wie früher sind, wie wir gleich sehen
werden).

Diese Methode ist auch dann anwendbar, wenn die Box nicht mehr sauber
hochfährt oder man kein Telnet auf der Box mit Original-Firmware hat
bzw. man es nicht schafft, es zu aktivieren.

.. _Voraussetzungen:

Voraussetzungen
---------------

Wir brauchen eine FritzBox mit Kernel 2.6 und EVA-Urlader, denn seit
älteren Versionen könnten die FTP-Befehle sich mehr oder weniger stark
verändert haben. Das weiß ich aber nicht genau. Es geht auch ein
entsprechendes OEM-Gerät, also z.B. Speedport W501V, W701V, W900V.

Außerdem benötigen wir ein **Linux**-System (auch eine virtuelle
Maschine, z.B. VMware, geht) mit installiertem
Standard-Kommandozeilen-Client *ftp* (bei mir das Debian-Paket *ftp
0.17-16*) oder aber mit `​NcFTP <http://en.wikipedia.org/wiki/Ncftp>`__
3.2.0 (bei mir Debian-Paket *ncftp 2:3.2.0-1*).

Alternativ funktioniert die beschriebene Prozedur mit NcFTP 3.2.0 auch
unter **Windows mit Cygwin**. Dort klappt es aber nicht mit dem
Standard-FTP-Client, mit dem Windows-FTP schon gar nicht.

Des weiteren sollte die Boot-IP der Box bekannt sein. Kennt man sie
nicht und kommt man nicht über eine Konsole (SSH, Telnet, Rudi-Shell,
Nano-Shell) an Informationen aus der Box, so kann man sie mittels
``ping`` herausfinden, indem man verschiedene IP-Adressen "anpingt"
direkt nach dem Aus- und Einschalten/-stecken der Box. Folgende IPs
werden häufig verwendet:

-  192.168.178.1 (allermeistens)
-  169.254.1.1
-  192.168.2.1
-  192.168.2.254

Die normale und einfache Methode, die Boot-IP herauszufinden, ist diese:

.. code:: wiki

   cat /proc/sys/urlader/environment | grep my_ipaddress

Man sollte dafür sorgen, dass Personal Firewalls ausgeschaltet sind,
evtl. auch andere Sicherheitspakete, die den Netzwerkverkehr behindern
könnten. Spätestens, wenn es mit aktiven Programmen nicht geht, sollte
man sie ausschalten, auch wenn man sich einbildet, alles sei richtig
eingestellt und daran könne es nicht liegen. Ganz ausschalten, nicht nur
inaktiv setzen!

Außerdem ist es hilfreich, dass der Rechner, von dem aus man die
Ping-Versuche unternimmt und die Verbindung per FTP initiieren möchte,
im gleichen Subnetz (z.B. 192.168.178.0/24 bzw. Netzmaske 255.255.255.0)
ist wie die Box, und zwar bzgl. der Adresse, die man gerade testet. Dass
übrigens der Ping von Windows aus funktioniert, bedeutet noch lange
nicht, dass man dann aus VMware heraus auch Verbindung aufnehmen kann.
Wirklich von dort probieren, wo man später arbeiten möchte.

Verbindungsversuche benötigen evtl. mehrere Anläufe, also wenn ein Ping
oder ein FTP-Connect nach drei, vier Sekunden nach Anschalten der Box
noch nicht geklappt hat, am besten aus- und wieder einschalten, bis der
Ping oder FTP-Connect funktioniert. Unter Windows sollte man ggf. auch
noch das Media Sensing ausschalten, indem man folgendes als Textdatei
``mediasensing-aus.reg`` speichert und doppelklickt, um es danach in die
Windows-Registry eintragen zu lassen:

.. code:: wiki

   Windows Registry Editor Version 5.00

   [HKEY_LOCAL_MACHINE\SYSTEM\ControlSet001\Services\Tcpip\Parameters]

   "DisableDHCPMediaSense"=dword:00000001

Evtl. sollte man nach dem Ausschalten einen Windows-Neustart machen.
AVMs Recover-Werkzeug macht das jedenfalls, aber vielleicht geht es auch
ohne. Man kann das Mediasensing dauerhaft ausgeschaltet lassen, sofern
man den betreffenden Rechner nicht ständig an verschiedenen Netzwerken
ein- und ausstöpselt und das Mediasensing für unterschiedliche
DHCP-Server benötigt (z.B. Notebook abwechselnd im Büro und zu Hause).
Sollte man es doch wieder einschalten wollen, geht das so:

.. code:: wiki

   Windows Registry Editor Version 5.00

   [HKEY_LOCAL_MACHINE\SYSTEM\ControlSet001\Services\Tcpip\Parameters]

   "DisableDHCPMediaSense"=dword:00000000

.. _AllgemeineInformationenzurDatensicherung:

Allgemeine Informationen zur Datensicherung
-------------------------------------------

Das im Folgenden gezeigte Vorgehen ist immer das gleiche, auch wenn
unterschiedliche Kommandozeilen-Clients verwendet werden. Man kann das
Ganze auch manuell im Dialog im FTP-Client durchführen, und außer den
genannten Clients funktionieren vermutlich noch einige andere. Passiven
Datentransfer sollten sie aber beherrschen, und Garantien gebe ich
sowieso nicht. |;-)| Die von mir getesteten Programme sollten ein
Gelingen aber wesentlich wahrscheinlicher machen.

Eine Seltsamkeit gibt es, auf die ich gleich hinweisen möchte: Immer
nach dem `Download <../../../Download.html>`__ einer ``mtd``-Partition
muß man manuell einmal Strg-C (engl. Ctrl-C) an der Kommandozeile des
FTP-Clients eingeben, damit der Client weiter läuft bzw. terminiert. Aus
irgendeinem Grund wird das Ende eines GET-Downloads nicht erkannt, was
wohl dem Urlader zuzuschreiben ist. Am besten kontrolliert man in einer
zweiten Konsole am Client, ob die Größe der
`Download <../../../Download.html>`__-Datei noch wächst. Nach ein paar
Sekunden sollte das nicht mehr der Fall sein. Die Urlader- und
TFFS-Partitionen sind sowieso fast augenblicklich heruntergeladen, nur
bei ``mtd1``, der Partition für Kernel + Dateisystem der Box, dauert es
ein bißchen länger, geht aber auch sehr schnell. Dabei gelten folgende
Dateigrößen:

-  Dateisystem + Kernel (``mtd1``):

   -  7.616 KB = 7.798.784 Bytes bei 8-MB-Boxen
   -  3.520 KB = 3.604.480 Bytes bei 4-MB-Boxen
   -  1.472 KB = 1.507.328 Bytes bei 2-MB-Boxen (theoretisch, diese
      Boxen haben momentan noch alte Urlader)

-  Urlader/Bootloader/EVA (mtd2): immer 64 KB = 65.536 Bytes
-  TFFS1 (mtd3): immer 256 KB = 262.144 Bytes
-  TFFS2 (mtd4): immer 256 KB = 262.144 Bytes

``mtd1-4`` summiert ergeben immer genau 8 bzw. 4 bzw. 2 MB, also die
Speichergröße der jeweiligen Box.

.. _SicherungmitLinux-Standard-FTPftp:

Sicherung mit Linux-Standard-FTP (ftp)
--------------------------------------

Folgenden Code am besten in eine Skript-Datei eintragen und von dort
ausführen wegen der Mehrzeiligkeit. Dabei die passende IP-Adresse
eintragen und nach dem vollständigen
`Download <../../../Download.html>`__ jeder Partition jeweils einmal
Strg-C drücken, damit die folgende heruntergeladen wird bzw. am Ende die
FTP-Sitzung beendet wird.

::

   (
   cat <<EOT
   open 192.168.178.1
   user adam2 adam2
   debug
   bin
   quote MEDIA FLSH
   get mtd1
   get mtd2
   get mtd3
   get mtd4
   quit
   EOT
   ) | ftp -n -p

Im Anschluß sollten sich im aktuellen Verzeichnis vier Dateien von
``mtd1`` bis ``mtd4`` befinden.

.. _SicherungmitLinux-NcFTPncftpget:

Sicherung mit Linux-NcFTP (ncftpget)
------------------------------------

Auch hier wieder die IP-Adresse ersetzen. Das Skript jeweils einmal für
jede der vier Partitionen von ``mtd1`` bis ``mtd4`` aufrufen, alles auf
einmal geht hier nicht. Aber Strg-C am Ende des
`Downloads <../../../Download.html>`__ ist auch hier zum Beenden
erforderlich.

.. code:: wiki

   ncftpget \
       -d stdout \
       -o doNotGetStartCWD=1,useFEAT=0,useHELP_SITE=0,useCLNT=0,useSIZE=0,useMDTM=0 \
       -W "quote MEDIA FLSH" \
       -u adam2 \
       -p adam2 \
       ftp://192.168.178.1/mtd1

.. _SicherungmitCygwin-NcFTPncftpget:

Sicherung mit Cygwin-NcFTP (ncftpget)
-------------------------------------

Das funktioniert genauso wie unter Linux mit der gleichnamigen
Anwendung, siehe oben.

.. _UploadsviaFTP:

Uploads via FTP
---------------

Analog hierzu kann man auch mit ``ftp`` bzw. ``ncftpput`` Uploads
machen, allerdings sollte man das im Normalfall nur für ``mtd1`` (Kernel
+ Dateisystem) machen, und dafür gibt es in ds26-15.2 bereits ein
bequemes Skript Namens ``tools/push_firmware.sh`` (ab 15.3 entfällt die
Endung ``.sh``), welches unter Linux und Windows + Cygwin läuft und
genaus das tut.

Das doppelt gepufferte TFFS - dort werden die Einstellungen der
Firmware, sowohl vom Hersteller als auch von Freetz, gespeichert -
sollte man nur im Notfall und immer nur auf genau die Box zurück
spielen, von der es stammt, denn es enthält einen Teil der Identität der
Box. Das hat sich seit dem Übergang von ADAM2 auf EVA zwar relativiert,
weil der wichtigste Teil der Angaben direkt in den Bootloader gewandert
ist - siehe `​Artikel von Enrik zu
EVA <http://wehavemorefun.de/fritzbox/index.php/EVA>`__ - aber man
sollte trotzdem damit aufpassen.

Was viel brisanter geworden ist, ist ein Überschreiben des Urladers,
denn er enthält seit dem Übergang auf EVA wirklich wichtige
box-individuelle Daten. Außerdem lässt er sich sowieso nicht via FTP
überschreiben, weil er während der FTP-Sitzung ja gerade aktiv ist. Im
Artikel `ADAM-Bootloader <adam2.html>`__ wird beschrieben, wie man den
Urlader direkt im laufenden Betrieb von der Konsole auf der Box aus
überschreiben kann, aber dort steht nicht, wie man die box-individuellen
Daten dort ins Image bekommt. Sie sollten also tunlichst bereits drin
sein oder man sollte sich die Update-Prozedur aus den Original-Firmwares
(z.B. 06.04.33, darin steckt ein Bootloader samt Update-Programm)
anschauen und sich o.g. Artikel von Enrik durchlesen.

|/!\\| **Ich kann nur dringendst davon abraten, den Urlader zu
überschreiben, das sollte auch nie notwendig sein!!!** |/!\\|

`​Alexander Kriegisch
(kriegaex) <http://www.ip-phone-forum.de/member.php?u=117253>`__

.. |:-)| image:: ../../../../chrome/wikiextras-icons-16/smiley.png
.. |;-)| image:: ../../../../chrome/wikiextras-icons-16/smiley-wink.png
.. |/!\\| image:: ../../../../chrome/wikiextras-icons-16/exclamation.png

