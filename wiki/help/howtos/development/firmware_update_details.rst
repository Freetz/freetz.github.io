help/howtos/development/firmware_update_details
===============================================
Howtos: Entwicklung
^^^^^^^^^^^^^^^^^^^

#. `Entpacken und Packen von
   Firmware-Images <repack_fw.html#EntpackenundPackenvonFirmware-Images>`__

   #. `Tools und Syntax <repack_fw.html#ToolsundSyntax>`__
   #. `Vorgehensweise <repack_fw.html#Vorgehensweise>`__
   #. `Verwendung von fwmod im "no
      freetz"-Modus <repack_fw.html#Verwendungvonfwmodimnofreetz-Modus>`__

#. `Patches in Freetz
   einspielen <integrate_patches.html#PatchesinFreetzeinspielen>`__
#. `Example 3:
   NZBGet <developer_information/package_development_start/example_3.html#Example3:NZBGet>`__

   #. `Build
      manually <developer_information/package_development_start/example_3.html#Buildmanually>`__
   #. `Add package to
      Freetz <developer_information/package_development_start/example_3.html#AddpackagetoFreetz>`__
   #. `Create new image with added
      package <developer_information/package_development_start/example_3.html#Createnewimagewithaddedpackage>`__
   #. `Testing <developer_information/package_development_start/example_3.html#Testing>`__
   #. `Preparing New Package for Public Integration to Freetz
      Trunk <developer_information/package_development_start/example_3.html#PreparingNewPackageforPublicIntegrationtoFreetzTrunk>`__

#. `Example 2:
   par2cmdline <developer_information/package_development_start/example_2.html#Example2:par2cmdline>`__

   #. `Build
      manually <developer_information/package_development_start/example_2.html#Buildmanually>`__
   #. `Add package to
      Freetz <developer_information/package_development_start/example_2.html#AddpackagetoFreetz>`__
   #. `Create new image with added
      package <developer_information/package_development_start/example_2.html#Createnewimagewithaddedpackage>`__
   #. `Testing <developer_information/package_development_start/example_2.html#Testing>`__
   #. `Preparing New Package for Public Integration to Freetz
      Trunk <developer_information/package_development_start/example_2.html#PreparingNewPackageforPublicIntegrationtoFreetzTrunk>`__

#. `Example 1:
   Httptunnel <developer_information/package_development_start/example_1.html#Example1:Httptunnel>`__

   #. `Build
      manually <developer_information/package_development_start/example_1.html#Buildmanually>`__
   #. `Add package to
      Freetz <developer_information/package_development_start/example_1.html#AddpackagetoFreetz>`__
   #. `Call Procedures "make menuconfig" and
      "make" <developer_information/package_development_start/example_1.html#CallProceduresmakemenuconfigandmake>`__
   #. `Testing <developer_information/package_development_start/example_1.html#Testing>`__
   #. `Preparing New Package for Public Integration to Freetz
      Trunk <developer_information/package_development_start/example_1.html#PreparingNewPackageforPublicIntegrationtoFreetzTrunk>`__

#. 

   #. `Signieren von Firmware <sign_image.html#SignierenvonFirmware>`__
   #. `Konkrete Anwendung in
      Freetz <sign_image.html#KonkreteAnwendunginFreetz>`__

#. `Ablauf eines
   Firmware-Updates <firmware_update_details.html#AblaufeinesFirmware-Updates>`__
#. `Eigene Programme
   kompilieren <compile_own_progs.html#EigeneProgrammekompilieren>`__
#. `Dynamische Bandbreitenanzeige per
   SVG <bandwidth_svg.html#DynamischeBandbreitenanzeigeperSVG>`__

   #. `Anleitung zur
      Test-Installation <bandwidth_svg.html#AnleitungzurTest-Installation>`__

#. `Platz sparen im Dateisystem der
   FritzBox <make_room.html#PlatzsparenimDateisystemderFritzBox>`__

   #. `Vorwort und Motivation <make_room.html#VorwortundMotivation>`__
   #. `Bestandsaufnahme: Wo stecken die
      Platzfresser? <make_room.html#Bestandsaufnahme:WosteckendiePlatzfresser>`__
   #. `Weitere Spartricks <make_room.html#WeitereSpartricks>`__
   #. `Schlußwort <make_room.html#Schlußwort>`__

#. `Flash-Partitionen im laufenden Betrieb
   sichern <save_mtd_1.html#Flash-PartitionenimlaufendenBetriebsichern>`__

   #. `Motivation <save_mtd_1.html#Motivation>`__
   #. `Voraussetzungen <save_mtd_1.html#Voraussetzungen>`__
   #. `Lösungsweg <save_mtd_1.html#Lösungsweg>`__
   #. `Wege, sich schnell einen Überblick zu
      verschaffen <save_mtd_1.html#WegesichschnelleinenÜberblickzuverschaffen>`__
   #. `Zusammenfassung <save_mtd_1.html#Zusammenfassung>`__

#. `Release Management <release_management.html#ReleaseManagement>`__

   #. `Subversion
      Repository <release_management.html#SubversionRepository>`__
   #. `Checklists <release_management.html#Checklists>`__
   #. `GIT <release_management.html#GIT>`__
   #. `Downloads <release_management.html#Downloads>`__
   #. `References <release_management.html#References>`__

#. `First steps - How to start your first freetz
   package <developer_information/package_development_start.html#Firststeps-Howtostartyourfirstfreetzpackage>`__

   #. `Info <developer_information/package_development_start.html#Info>`__
   #. `Build
      Environment <developer_information/package_development_start.html#BuildEnvironment>`__
   #. `File
      Structure <developer_information/package_development_start.html#FileStructure>`__
   #. `Examples Binary
      Package <developer_information/package_development_start.html#ExamplesBinaryPackage>`__
   #. `Configuration
      Handling <developer_information/package_development_start.html#ConfigurationHandling>`__
   #. `Examples
      Web-Interface <developer_information/package_development_start.html#ExamplesWeb-Interface>`__
   #. `Trouble
      shooting <developer_information/package_development_start.html#Troubleshooting>`__

#. `Kernel konfigurieren und
   kompilieren <make_kernel.html#Kernelkonfigurierenundkompilieren>`__
#. `Menükonfiguration
   pflegen <menuconfig.html#Menükonfigurationpflegen>`__

   #. `Einstieg <menuconfig.html#Einstieg>`__
   #. `Beispiel-Konfiguration für ein neues
      Paket <menuconfig.html#Beispiel-KonfigurationfüreinneuesPaket>`__
   #. `Menuconfig-Warnungen
      beheben <menuconfig.html#Menuconfig-Warnungenbeheben>`__
   #. `Erklärung und Anwendung der erweiterten
      MK-Targets <menuconfig.html#ErklärungundAnwendungdererweitertenMK-Targets>`__
   #. `Syntax-Fehler in MK-Dateien
      finden <menuconfig.html#Syntax-FehlerinMK-Dateienfinden>`__
   #. `Syntax-Hervorhebung für
      MK-Dateien <menuconfig.html#Syntax-HervorhebungfürMK-Dateien>`__

#. `ADAM2-Bootloader <adam2.html#ADAM2-Bootloader>`__

   #. `Bootloader-Backup
      anlegen <adam2.html#Bootloader-Backupanlegen>`__
   #. `Bootloader überschreiben <adam2.html#Bootloaderüberschreiben>`__
   #. `Bootloader-Befehle <adam2.html#Bootloader-Befehle>`__
   #. `Bootloader-Quelltext <adam2.html#Bootloader-Quelltext>`__
   #. `Aufbau des Bootloaders <adam2.html#AufbaudesBootloaders>`__
   #. `Bootloader und Freetz <adam2.html#BootloaderundFreetz>`__

#. `Einstellungen speichern im
   Urlader-Environment <urlader_flags.html#EinstellungenspeichernimUrlader-Environment>`__

   #. `Vorwort und
      Motivation <urlader_flags.html#VorwortundMotivation>`__
   #. `Lösungsmöglichkeiten <urlader_flags.html#Lösungsmöglichkeiten>`__
   #. `Bootloader
      Environment <urlader_flags.html#BootloaderEnvironment>`__
   #. `Variable
      "kernel_args" <urlader_flags.html#Variablekernel_args>`__
   #. `Kernel_Args-API <urlader_flags.html#Kernel_Args-API>`__
   #. `Mögliche
      Anwendungsfälle <urlader_flags.html#MöglicheAnwendungsfälle>`__

#. `Busybox konfigurieren und
   kompilieren <make_busybox.html#Busyboxkonfigurierenundkompilieren>`__
#. `Wie baue ich ein eigenes Paket für
   Freetz? <package_creation.html#WiebaueicheineigenesPaketfürFreetz>`__
#. `Firmware-Image-Namen analysieren und
   interpretieren <analyse_image_names.html#Firmware-Image-Namenanalysierenundinterpretieren>`__

   #. `Einleitung <analyse_image_names.html#Einleitung>`__
   #. `Skript-Code <analyse_image_names.html#Skript-Code>`__
   #. `Daten im Rohformat <analyse_image_names.html#DatenimRohformat>`__
   #. `Ausgabe grundlegender
      Informationen <analyse_image_names.html#AusgabegrundlegenderInformationen>`__
   #. `Ausgabe erweiterter
      Informationen <analyse_image_names.html#AusgabeerweiterterInformationen>`__

#. 

   #. `Web-interface
      HTTPTunnel <developer_information/package_development_start/webinterface_example_1.html#Web-interfaceHTTPTunnel>`__

#. `Developer
   Information <developer_information.html#DeveloperInformation>`__
#. `Addon Paket
   installieren <install_addon.html#AddonPaketinstallieren>`__
#. `Paketverwaltung für
   Freetz <developer_information/package_development_dynamic.html#PaketverwaltungfürFreetz>`__

   #. `Erweiterung des
      Dateisystems <developer_information/package_development_dynamic.html#ErweiterungdesDateisystems>`__
   #. `Paketverwaltung <developer_information/package_development_dynamic.html#Paketverwaltung>`__
   #. `Links <developer_information/package_development_dynamic.html#Links>`__
   #. `Kommentare <developer_information/package_development_dynamic.html#Kommentare>`__

#. `Wie die FritzBox Manipulationen
   erkennt <manipulation_detection.html#WiedieFritzBoxManipulationenerkennt>`__

   #. `Ursachen <manipulation_detection.html#Ursachen>`__
   #. `Diagnose <manipulation_detection.html#Diagnose>`__
   #. `Lösungen <manipulation_detection.html#Lösungen>`__
   #. `Schlußwort und
      Ausblick <manipulation_detection.html#SchlußwortundAusblick>`__

#. `Shell Coding
   Conventions <developer_information/shell_coding_conventions.html#ShellCodingConventions>`__

   #. `Shell
      Language <developer_information/shell_coding_conventions.html#ShellLanguage>`__
   #. `Basic
      Format <developer_information/shell_coding_conventions.html#BasicFormat>`__
   #. `If, For, and
      While <developer_information/shell_coding_conventions.html#IfForandWhile>`__
   #. `Test
      Built-in <developer_information/shell_coding_conventions.html#TestBuilt-in>`__
   #. `Single-line conditional
      statements <developer_information/shell_coding_conventions.html#Single-lineconditionalstatements>`__
   #. `Infinite
      Loops <developer_information/shell_coding_conventions.html#InfiniteLoops>`__
   #. `Exit Status and If/While
      Statements <developer_information/shell_coding_conventions.html#ExitStatusandIfWhileStatements>`__
   #. `Variable
      References <developer_information/shell_coding_conventions.html#VariableReferences>`__
   #. `Variable
      Naming <developer_information/shell_coding_conventions.html#VariableNaming>`__
   #. `Quoting <developer_information/shell_coding_conventions.html#Quoting>`__
   #. `Variable
      Assignments <developer_information/shell_coding_conventions.html#VariableAssignments>`__
   #. `Testing for (Non-)Empty
      Strings <developer_information/shell_coding_conventions.html#TestingforNon-EmptyStrings>`__
   #. `Commenting <developer_information/shell_coding_conventions.html#Commenting>`__
   #. `Pathnames <developer_information/shell_coding_conventions.html#Pathnames>`__
   #. `Interpreter
      Magic <developer_information/shell_coding_conventions.html#InterpreterMagic>`__

#. `Package
   Development <developer_information/package_development.html#PackageDevelopment>`__

   #. `Persistent Package
      Settings <developer_information/package_development.html#PersistentPackageSettings>`__

#. `Erstellen einer GUI für Pakete in
   Freetz <create_gui.html#ErstelleneinerGUIfürPaketeinFreetz>`__

   #. `Motivation <create_gui.html#Motivation>`__
   #. `Grundlagen <create_gui.html#Grundlagen>`__
   #. `Wie funktioniert das mit der
      GUI? <create_gui.html#WiefunktioniertdasmitderGUI>`__

#. `Flash Partitionierung <flash.html#FlashPartitionierung>`__

   #. `Hidden SquashFS <flash.html#HiddenSquashFS>`__
   #. `Contiguous SquashFS <flash.html#ContiguousSquashFS>`__
   #. `Hidden Root <flash.html#HiddenRoot>`__
   #. `NAND Root <flash.html#NANDRoot>`__
   #. `Dateisystem <flash.html#Dateisystem>`__
   #. `Kernel <flash.html#Kernel>`__
   #. `Weblinks <flash.html#Weblinks>`__

#. `Trac
   Hooks <developer_information/post_commit_hook.html#TracHooks>`__

   #. `trac-post-commit-hook <developer_information/post_commit_hook.html#trac-post-commit-hook>`__
   #. `trac-post-revprop-change-hook <developer_information/post_commit_hook.html#trac-post-revprop-change-hook>`__

#. `Package Developing - Advanced
   Topics <developer_information/package_development_advanced.html#PackageDeveloping-AdvancedTopics>`__

   #. `Adding conditional
      patches <developer_information/package_development_advanced.html#Addingconditionalpatches>`__
   #. `Adding multi-binary
      packages <developer_information/package_development_advanced.html#Addingmulti-binarypackages>`__

#. `Eigene Dateien in die Firmware
   integrieren <integrate_own_files.html#EigeneDateienindieFirmwareintegrieren>`__

   #. `Feste Integration über das Freetz
      Image <integrate_own_files.html#FesteIntegrationüberdasFreetzImage>`__
   #. `Erzeugen der Dateien aus der
      debug.cfg <integrate_own_files.html#ErzeugenderDateienausderdebug.cfg>`__
   #. `Nachladen vom
      Webserver <integrate_own_files.html#NachladenvomWebserver>`__
   #. `Nachladen vom
      USB-Stick <integrate_own_files.html#NachladenvomUSB-Stick>`__
   #. `WebDAV Share
      mounten <integrate_own_files.html#WebDAVSharemounten>`__
   #. `NFS-Share mounten <integrate_own_files.html#NFS-Sharemounten>`__

#. `Freetz Build-Prozeß <freetz_make.html#FreetzBuild-Prozeß>`__

   #. `Vorwort und Motivation <freetz_make.html#VorwortundMotivation>`__
   #. `Grundsätzliches <freetz_make.html#Grundsätzliches>`__

#. `Flash-Partitionen von außen mit FTP
   sichern <save_mtd_2.html#Flash-PartitionenvonaußenmitFTPsichern>`__

   #. `Motivation <save_mtd_2.html#Motivation>`__
   #. `Voraussetzungen <save_mtd_2.html#Voraussetzungen>`__
   #. `Allgemeine Informationen zur
      Datensicherung <save_mtd_2.html#AllgemeineInformationenzurDatensicherung>`__
   #. `Sicherung mit Linux-Standard-FTP
      (ftp) <save_mtd_2.html#SicherungmitLinux-Standard-FTPftp>`__
   #. `Sicherung mit Linux-NcFTP
      (ncftpget) <save_mtd_2.html#SicherungmitLinux-NcFTPncftpget>`__
   #. `Sicherung mit Cygwin-NcFTP
      (ncftpget) <save_mtd_2.html#SicherungmitCygwin-NcFTPncftpget>`__
   #. `Uploads via FTP <save_mtd_2.html#UploadsviaFTP>`__

#. `libmodcgi.sh <developer_information/webif/libmodcgi.html#libmodcgi.sh>`__

   #. `cgi <developer_information/webif/libmodcgi.html#cgi>`__
   #. `cgi_begin <developer_information/webif/libmodcgi.html#cgi_begin>`__
   #. `cgi_end <developer_information/webif/libmodcgi.html#cgi_end>`__
   #. `sec_begin <developer_information/webif/libmodcgi.html#sec_begin>`__
   #. `sec_end <developer_information/webif/libmodcgi.html#sec_end>`__
   #. `html <developer_information/webif/libmodcgi.html#html>`__
   #. `check,
      select <developer_information/webif/libmodcgi.html#checkselect>`__
   #. `href <developer_information/webif/libmodcgi.html#href>`__
   #. `back_button <developer_information/webif/libmodcgi.html#back_button>`__
   #. `sec_level <developer_information/webif/libmodcgi.html#sec_level>`__
   #. `stat_bar <developer_information/webif/libmodcgi.html#stat_bar>`__
   #. `cgi_param <developer_information/webif/libmodcgi.html#cgi_param>`__
   #. `cgi_error,
      print_error <developer_information/webif/libmodcgi.html#cgi_errorprint_error>`__
   #. `path_info <developer_information/webif/libmodcgi.html#path_info>`__
   #. `valid <developer_information/webif/libmodcgi.html#valid>`__

#. `Cross-Compiler / Toolchain
   erstellen <create_cross-compiler_toolchain.html#Cross-CompilerToolchainerstellen>`__
#. `Eigene Download-Toolchain
   erstellen <create_cross-compiler_toolchain.html#EigeneDownload-Toolchainerstellen>`__
#. `Target/Native-Compiler-Toolchain
   erstellen <create_cross-compiler_toolchain.html#TargetNative-Compiler-Toolchainerstellen>`__

   #. `Using the dev-tools package to install compiler and
      tools <create_cross-compiler_toolchain.html#Usingthedev-toolspackagetoinstallcompilerandtools>`__

.. _AblaufeinesFirmware-Updates:

Ablauf eines Firmware-Updates
=============================

Bei einem Firmware-Update über das AVM-Web-Interface passiert in etwa
Folgendes (kein Anspruch auf Vollständigkeit):

-  Die Steuerung des gesamten Vorgangs übernimmt das Binary
   ``/usr/www/cgi-bin/firmwarecfg``. Es wird vom Webserver aufgerufen.
-  ``firmwarecfg`` ruft zunächst das Shell-Skript
   ``/bin/prepare_fwupgrade`` auf, um diverse Dienste zu stoppen und
   somit Platz im RAM für das Firmware-Archiv zu schaffen. Auch Spuren
   von evtl. früheren Updates in der RAM-Disk (``/var``) werden
   gelöscht. ``prepare_fwupgrade`` wird entweder mit dem Parameter
   *start* oder mit *start_from_internet* aufgerufen, je nachdem, ob ein
   Update von der AVM-Seite geladen werden soll oder von Festplatte. Der
   Unterschied besteht v.a. darin, daß der DSL-Daemon ``dsld`` im
   zweiten Fall zunächst nicht gestoppt wird.
-  Nachdem nun ein Großteil der Aktivitäten der FritzBox stillgelegt
   ist, wird das Firmware-Image in die RAM-Disk übertragen und dort
   mittels tar entpackt. Dabei wird die digitale Signatur des Pakets
   geprüft. Falls sie nicht korrekt verifiziert werden kann oder fehlt,
   wird später die bekannte Meldung über eine nicht freigegebene
   Firmware im Web-Interface angezeigt. Zunächst wird der Benutzer des
   Web-Interfaces via Rückmeldung von ``firmwarecfg`` aber einfach nur
   gefragt, ob er trotzdem die Firmware installieren möchte. Nehmen wir
   an, er bejaht das.
-  Die wichtigsten Dateien des entpackten Firmware-Archivs liegen nun
   unter

   -  ``/var/install``
   -  ``/var/tmp/kernel.image``
   -  ``/var/tmp/filesystem.image``

-  Die letzten beiden Dateien liegen nur vor, wenn es sich um ein
   "echtes" Update und nicht um ein Pseudo-Update, z.B. zum Aktivieren
   von Telnet oder zur Installation einer Software wie dem *LCR Updater*
   handelt. ``filesystem.image`` hat in vielen Fällen die Länge null,
   weil in ``kernel.image`` alle benötigten Daten fürs Flashen enthalten
   sind.
-  Ein zweites Mal wird ``/bin/prepare_fwupgrade`` aufgerufen, dieses
   Mal mit dem Parameter *end*. Jetzt werden endgültig die verbleibenden
   Dienste gestoppt, die noch während des Updates stören könnten, indem
   sie z.B. auf den Flash-Speicher zugreifen.
-  Jetzt wird das mit dem Firmware-Image entpackte Shell-Skript
   ``/var/install`` aufgerufen. Darin passiert eine ganze Menge, z.B.:
-  Es werden diverse Prüfungen durchgeführt, die bestimmen, auf welchem
   Stand die Box momentan ist, wie der Flash-Bereich partitioniert ist
   und was zu tun ist in Vorbereitung aufs Update. Je nachdem, was das
   Skript herausfindet über die Situation, gibt es am Ende einen der
   folgenden Werte zurück:

   -  *INSTALL_SUCCESS_NO_REBOOT (0)* - alles okay, Neustart der Box
      nicht erforderlich. Dieser Wert sollte nur zurückgegeben werden,
      wenn an Dateisystem und Kernel im Flash nichts geändert wird.
   -  *INSTALL_SUCCESS_REBOOT = 1* - der Standardwert bei "richtigen"
      Firmware-Updates. Alles okay, Box neu starten.
   -  *INSTALL_WRONG_HARDWARE = 2* - Installation zurückweisen, weil
      etwas an der Hardware nicht zum Firmware-Image paßt (Problem mit
      dem Annex, falscher OEM).
   -  *INSTALL_KERNEL_CHECKSUM = 3* - fehlerhafte Kernel-Checksumme.
      Falls die beiden Image-Dateien (Kernel und Filesystem) existieren,
      werden ihre CRC-Checksummen durch Aufruf des ebenfalls in
      AVM-Paketen enthaltenen ``/var/chksum`` geprüft. Sind die
      Checksummen - nicht Verwechseln mit der o.g. Signatur - nicht in
      Ordnung, findet kein Update statt.
   -  *INSTALL_FILESYSTEM_CHECKSUM = 4* - siehe voriger Punkt.
   -  *INSTALL_URLADER_CHECKSUM = 5* - würde bedeuten, dass der zu
      installierende neue Urlader eine falsche Checksumme hat. Meistens
      enthalten Firmware-Updates jedoch keinen neuen Urlader.
   -  *INSTALL_OTHER_ERROR = 6* - sonstiger Fehler.
   -  *INSTALL_FIRMWARE_VERSION = 7* - Problem mit der aktuellen
      Firmware-Version. Entweder kann die aktuelle Version aus
      irgendeinem Grund nicht festgestellt werden oder der
      Versionssprung ist zu groß, weil noch jemand eine Uralt-Version
      installiert hat und zunächst ein Zwischen-Update auf eine andere
      Version ebötigt, um anschließend die neue einspielen zu können.
   -  *INSTALL_DOWNGRADE_NEEDED = 8* - es wird versucht, eine Firmware
      mit niedrigerer Versionsnummer zu installieren. Normalerweise
      blockieren aktuelle Firmwares das, weswegen man den Umweg über ein
      Recover bzw. einen manuellen Downgrade machen muss, um diese Hürde
      zu nehmen. (Man könnte auch einfach die Prüfung in diesem Skript
      auskommentieren.)

-  Das Skript hat auch einen Schalter *-f*, welcher es dazu veranlaßt,
   eine beliebige Firmware-Versionsnummer zu akzeptieren und somit ggf.
   auch einen Downgrade durchzuführen. Allerdings lässt sich der
   Schalter übers Web-Interface meines Wissens nicht setzen. Vermutlich
   wird er von den AVM-Recovery-Tools benutzt. Verbunden mit dem Setzen
   dieses Schalters ist, dass das gerade besprochene Install-Skript auch
   die Einstellungen im Flash löscht und somit die Box auf die
   Werkseinstellungen zurücksetzt. Grundsätzlich könnte man Letzteres
   durch Auskommentieren im Skript verhindern, aber es macht oft genug
   Sinn, es so zu lassen. Ein Downgrade bedeutet nun einmal, dass evtl.
   vorhandene Einstellungen für Features einer neuen Firmware-Version
   von einer älteren nicht richtig interpretiert werden könnten und
   somit schlimmstenfalls die Box schon beim Starten hängen bleiben und
   endgültig zum Recover-Fall werden würde.
-  Zum Schluß werden ggf. noch einige Spezialitäten abgehandelt, z.B.
   Entfernen veralteter Einstellungen oder Konvertierung alter
   Wahlregeln.
-  Das Skript schreibt während des Ablaufs parallel auch noch ein
   weiteres Skript nach ``/var/post_install``, welches anschließend über
   ``init reboot`` indirekt vom führenden Prozeß ``firmwarecfg``
   aufgerufen wird, sofern nicht einer der Fehler-Rückgabewerte dies
   verhindert. ``post_install`` wiederum setzt für den Flash-Vorgang
   notwendige Umgebungsvariablen und lädt das im Firmware-Image
   enthaltene Modul ``/var/flash_update.o`` (Kernel 2.4) bzw.
   ``/var/flash_update.ko`` (Kernel 2.6).
-  Übrigens gibt es auch standardmäßig ein ``/var/post_install``, das
   beim Systemstart aus ``/var.tar`` extrahiert wird und vor jedem
   Reboot aufgerufen wird. Der Aufruf-Mechanismus über ``/etc/inittab``
   ist der gleiche, der Inhalt des Skripts jedoch völlig anders als in
   der Spezialversion vor dem Flashen.
-  Jetzt erfolgt der eigentliche Flash-Vorgang (falls notwendig).

Nach dem eventuellen Reboot hat man ggf. eine nagelneue Firmware auf der
Box, andernfalls die gewünschte nachinstallierte Funktionalität. Was
``/var/install`` macht und welchen Return-Wert es liefert, ist
grundsätzlich für jeden Firmware-Bastler frei entscheidbar. Die anderen
Rahmenbedingungen sind so, wie ich es eben beschrieben habe.

`​Alexander Kriegisch
(kriegaex) <http://www.ip-phone-forum.de/member.php?u=117253>`__
